{"version":3,"sources":["../../app-es6/service/NegociacaoService.js"],"names":["NegociacaoService","_httpService","HttpService","url","mensagemErro","Promise","resolve","reject","get","then","negociacoes","map","NegociacaoHelper","converterObjetoEmNegociacao","dado","catch","console","log","erro","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","periodos","reduce","dados","periodo","concat","Error","obterNegociacoes","negociacao","ConnectionFactory","getConnection","NegociacaoDao","connection","dao","adiciona","listaTodos","apagaTodos","listaAtual","obterTodasNegociacoes","filter","some","JSON","stringify","negociacaoExistente"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["class NegociacaoService {\r\n  constructor(){\r\n    this._httpService = new HttpService();\r\n  }\r\n\r\n  obterNegociacoes(url, mensagemErro) {\r\n    return new Promise( (resolve, reject) => {\r\n      this._httpService\r\n          .get(url)\r\n          .then( negociacoes => {\r\n            resolve(negociacoes.map(dado => NegociacaoHelper.converterObjetoEmNegociacao(dado)))\r\n          })\r\n          .catch(erro => {\r\n            console.log(erro);\r\n            reject(mensagemErro);\r\n          });\r\n    } );\r\n  }\r\n\r\n  obterTodasNegociacoes(){\r\n    return Promise.all([// Resolve estas promesis nessa ordem\r\n            this.obterNegociacoesDaSemana(),\r\n            this.obterNegociacoesDaSemanaAnterior(),\r\n            this.obterNegociacoesDaSemanaRetrasada()\r\n        ]).then(periodos => {\r\n\r\n            let negociacoes = periodos\r\n                .reduce((dados, periodo) => dados.concat(periodo), [])// Vai retornar um array com todas as negociações concatenadas dentro\r\n                .map(dado => NegociacaoHelper.converterObjetoEmNegociacao(dado));\r\n\r\n            return negociacoes;\r\n        }).catch(erro => {\r\n            throw new Error(erro);\r\n        });\r\n  }\r\n\r\n  obterNegociacoesDaSemana() {\r\n    return this.obterNegociacoes('negociacoes/semana', 'Não foi possível obter as negociações da semana.');\r\n  }\r\n\r\n  obterNegociacoesDaSemanaRetrasada() {\r\n    return this.obterNegociacoes('negociacoes/retrasada', 'Não foi possivel obter as negociações da semana retrasada');\r\n  }\r\n\r\n  obterNegociacoesDaSemanaAnterior() {\r\n    return this.obterNegociacoes('negociacoes/anterior', 'Não foi possivel obter as negociações da semana anterior');\r\n  }\r\n\r\n  cadastra(negociacao){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.adiciona(negociacao))\r\n      .then(() => 'Negociacao adicionada com sucesso.')\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível adicionar a negociacao.')\r\n      });\r\n  }\r\n\r\n  lista(){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.listaTodos())\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível obter as negociações.');\r\n      })\r\n  }\r\n\r\n  apaga(){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.apagaTodos())\r\n      .then(() => 'Negociações apagadas com sucesso.')\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível apagar as negociações.');\r\n      })\r\n  }\r\n\r\n  importa(listaAtual){\r\n    return this.obterTodasNegociacoes()\r\n      .then(negociacoes =>\r\n        negociacoes.filter(negociacao => // Filtra o array de negociações com base na condição retornada\r\n          !listaAtual // Negação do resultado do some()\r\n            .some( // some() percorre o array até a condição ser true, caso nunca seja ele retorna false\r\n              // Realiza a comparação do JSON (string) dos objetos\r\n              negociacaoExistente => JSON.stringify(negociacao) == JSON.stringify(negociacaoExistente)\r\n            )\r\n        )\r\n      )\r\n      .catch(erro => {\r\n        console.log(erro);\r\n        throw new Error('Não foi possível importar as negociações.');\r\n      });\r\n  }\r\n}\r\n"]}