{"version":3,"sources":["../../app-es6/controller/NegociacaoController.js"],"names":["ListaNegociacoes","Negociacao","Mensagem","NegociacaoService","MensagemView","NegociacoesView","Bind","DateHelper","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","_importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","apaga","esvazia","data","textForDate","value","parseInt","parseFloat","importa","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../model/ListaNegociacoes';\r\nimport {Negociacao} from '../model/Negociacao';\r\nimport {Mensagem} from '../model/Mensagem';\r\nimport {NegociacaoService} from '../service/NegociacaoService';\r\nimport {MensagemView} from '../view/MensagemView';\r\nimport {NegociacoesView} from '../view/NegociacoesView';\r\nimport {Bind} from '../helper/Bind';\r\nimport {DateHelper} from '../helper/DateHelper';\r\n\r\nexport class NegociacaoController{\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document); // Macete para diminuir a repetição do método, similar ao JQuery\r\n\r\n    this._inputData = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($('#negociacoesView')), 'adiciona', 'esvazia');\r\n\r\n    this._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), 'texto');\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init(){\r\n    this._service\r\n      .lista()\r\n      .then(negociacoes =>\r\n        negociacoes.forEach(negociacao =>\r\n          this._listaNegociacoes.adiciona(negociacao)\r\n        )\r\n      )\r\n      .catch(erro => this._mensagem.texto = erro);\r\n\r\n      setInterval(() => this._importaNegociacoes(), 3000); // Executa no tempo determinado\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    let negociacao = this._criaNegociacao();\r\n\r\n    this._service\r\n      .cadastra(negociacao)\r\n      .then(mensagem => {\r\n        this._listaNegociacoes.adiciona(negociacao);\r\n        this._mensagem.texto = mensagem;\r\n        this._limpaFormulario();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  apaga(){\r\n    this._service\r\n      .apaga()\r\n      .then(mensagem => {\r\n        this._mensagem.texto = mensagem;\r\n        this._listaNegociacoes.esvazia();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    let data = DateHelper.textForDate(this._inputData.value);\r\n\r\n    return new Negociacao(\r\n      data,\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _importaNegociacoes(){\r\n    this._service\r\n    .importa(this._listaNegociacoes.negociacoes)\r\n    .then(negociacoes => {negociacoes.forEach(negociacao =>\r\n        this._listaNegociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações importadas com sucesso.';\r\n    })\r\n    .catch(erro => this._mensagem.texto = erro); // Pega o erro da promesi que acabou de executar\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n}\r\n"]}