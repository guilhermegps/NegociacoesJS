{"version":3,"sources":["../../app-es6/controller/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","_importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","apaga","esvazia","data","DateHelper","textForDate","value","Negociacao","parseInt","parseFloat","importa","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController{\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document); // Macete para diminuir a repetição do método, similar ao JQuery\r\n\r\n    this._inputData = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($('#negociacoesView')), 'adiciona', 'esvazia');\r\n\r\n    this._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), 'texto');\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init(){\r\n    this._service\r\n      .lista()\r\n      .then(negociacoes =>\r\n        negociacoes.forEach(negociacao =>\r\n          this._listaNegociacoes.adiciona(negociacao)\r\n        )\r\n      )\r\n      .catch(erro => this._mensagem.texto = erro);\r\n\r\n      setInterval(() => this._importaNegociacoes(), 3000); // Executa no tempo determinado\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    let negociacao = this._criaNegociacao();\r\n\r\n    this._service\r\n      .cadastra(negociacao)\r\n      .then(mensagem => {\r\n        this._listaNegociacoes.adiciona(negociacao);\r\n        this._mensagem.texto = mensagem;\r\n        this._limpaFormulario();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  apaga(){\r\n    this._service\r\n      .apaga()\r\n      .then(mensagem => {\r\n        this._mensagem.texto = mensagem;\r\n        this._listaNegociacoes.esvazia();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    let data = DateHelper.textForDate(this._inputData.value);\r\n\r\n    return new Negociacao(\r\n      data,\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _importaNegociacoes(){\r\n    this._service\r\n    .importa(this._listaNegociacoes.negociacoes)\r\n    .then(negociacoes => {negociacoes.forEach(negociacao =>\r\n        this._listaNegociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações importadas com sucesso.';\r\n    })\r\n    .catch(erro => this._mensagem.texto = erro); // Pega o erro da promesi que acabou de executar\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n}\r\n"]}