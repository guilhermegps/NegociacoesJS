{"version":3,"sources":["../../app-es6/dao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","connection","_connection","_store","transaction","objectStore","negociacao","Promise","resolve","reject","request","_obtemConnectionStore","add","onsuccess","onerror","console","log","e","target","result","error","clear","cursor","openCursor","negociacoes","atual","dado","value","push","_data","_quantidade","_valor","continue"],"mappings":";;;;;;;;;;;;;;;AAAQA,gB,oBAAAA,U;;;;;;;;;;;;;;;;;;;;;+BAEKC,a;AACX,+BAAYC,UAAZ,EAAwB;AAAA;;AACtB,eAAKC,WAAL,GAAmBD,UAAnB;AACA,eAAKE,MAAL,GAAc,aAAd;AACD;;;;kDAEsB;AACrB,mBAAO,KAAKD,WAAL,CACJE,WADI,CACQ,CAAC,KAAKD,MAAN,CADR,EACuB,WADvB,EACoC;AADpC,aAEJE,WAFI,CAEQ,KAAKF,MAFb,CAAP,CADqB,CAGO;AAC7B;;;mCAEQG,U,EAAW;AAAA;;AAClB,mBAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,kBAAIC,UAAU,MAAKC,qBAAL,GAA6BC,GAA7B,CAAiCN,UAAjC,CAAd,CADsC,CACsB;;AAE5DI,sBAAQG,SAAR,GAAoB,aAAK;AACvBL;AACD,eAFD;;AAIAE,sBAAQI,OAAR,GAAkB,aAAK;AACrBC,wBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,MAAT,CAAgBC,KAA5B;AACAX,uBAAO,2CAAP;AACD,eAHD;AAID,aAXM,CAAP;AAYD;;;uCAEY;AAAA;;AACX,mBAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,kBAAIC,UAAU,OAAKC,qBAAL,GAA6BU,KAA7B,EAAd;;AAEEX,sBAAQG,SAAR,GAAoB;AAAA,uBAAKL,QAAQ,oCAAR,CAAL;AAAA,eAApB;;AAEAE,sBAAQI,OAAR,GAAkB,aAAK;AACrBC,wBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASE,KAArB;AACAX,uBAAO,yCAAP;AACD,eAHD;AAIH,aATM,CAAP;AAUD;;;uCAEW;AAAA;;AACV,mBAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,kBAAIa,SAAS,OAAKX,qBAAL,GAA6BY,UAA7B,EAAb,CADsC,CACiB;;AAEvD,kBAAIC,cAAc,EAAlB;AACAF,qBAAOT,SAAP,GAAmB,aAAK;AACtB,oBAAIY,QAAQR,EAAEC,MAAF,CAASC,MAArB,CADsB,CACO;;AAE7B,oBAAGM,KAAH,EAAS;AAAE;AACT,sBAAIC,OAAOD,MAAME,KAAjB,CADO,CACiB;AACxBH,8BAAYI,IAAZ,CAAiB,IAAI7B,UAAJ,CAAe2B,KAAKG,KAApB,EAA2BH,KAAKI,WAAhC,EAA6CJ,KAAKK,MAAlD,CAAjB;AACAN,wBAAMO,QAAN,GAHO,CAGW;AACnB,iBAJD,MAIO;AACLxB,0BAAQgB,WAAR;AACD;AACF,eAVD;;AAYAF,qBAAOR,OAAP,GAAiB,aAAK;AACpBL,uBAAO,wCAAP;AACD,eAFD;AAGD,aAnBM,CAAP;AAoBD","file":"NegociacaoDao.js","sourcesContent":["import {Negociacao} from '../model/Negociacao';\r\n\r\nexport class NegociacaoDao {\r\n  constructor(connection) {\r\n    this._connection = connection;\r\n    this._store = 'negociacoes';\r\n  }\r\n\r\n  _obtemConnectionStore(){\r\n    return this._connection\r\n      .transaction([this._store], 'readwrite') // connection.transaction(OBJECT STORES, TIPO DE OPERAÇÃO\r\n      .objectStore(this._store) // Pego a Object Store Transacional\r\n  }\r\n\r\n  adiciona(negociacao){\r\n    return new Promise((resolve, reject) => {\r\n      let request = this._obtemConnectionStore().add(negociacao); // Requisição para gravar na store\r\n\r\n      request.onsuccess = e => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = e => {\r\n        console.log(e.target.result.error);\r\n        reject('Não foi possível adicionar uma negociação');\r\n      };\r\n    });\r\n  }\r\n\r\n  apagaTodos() {\r\n    return new Promise((resolve, reject) => {\r\n      let request = this._obtemConnectionStore().clear();\r\n\r\n        request.onsuccess = e => resolve('Negociações removidas com sucesso.');\r\n\r\n        request.onerror = e => {\r\n          console.log(e.target.error);\r\n          reject('Não foi possível apagar as negociações.');\r\n        };\r\n    });\r\n  }\r\n\r\n  listaTodos(){\r\n    return new Promise((resolve, reject) => {\r\n      let cursor = this._obtemConnectionStore().openCursor();// Ele que navega pela Object store\r\n\r\n      let negociacoes = [];\r\n      cursor.onsuccess = e => {\r\n        let atual = e.target.result; // Ponteiro para a negociação atual sendo lida\r\n\r\n        if(atual){ // Se houver dados sendo lidos\r\n          let dado = atual.value; // Pegando o dado real do ponteiro\r\n          negociacoes.push(new Negociacao(dado._data, dado._quantidade, dado._valor));\r\n          atual.continue(); // Manda ir para o proximo\r\n        } else {\r\n          resolve(negociacoes);\r\n        }\r\n      };\r\n\r\n      cursor.onerror = e => {\r\n        reject('Não foi possível listar as negociações');\r\n      };\r\n    });\r\n  }\r\n}\r\n"]}