{"version":3,"sources":["../../app-es6/dao/NegociacaoDao.js"],"names":["NegociacaoDao","connection","_connection","_store","transaction","objectStore","negociacao","Promise","resolve","reject","request","_obtemConnectionStore","add","onsuccess","onerror","console","log","e","target","result","error","clear","cursor","openCursor","negociacoes","atual","dado","value","push","Negociacao","_data","_quantidade","_valor","continue"],"mappings":";;;;;;IAAMA,a;AACJ,yBAAYC,UAAZ,EAAwB;AAAA;;AACtB,SAAKC,WAAL,GAAmBD,UAAnB;AACA,SAAKE,MAAL,GAAc,aAAd;AACD;;;;4CAEsB;AACrB,aAAO,KAAKD,WAAL,CACJE,WADI,CACQ,CAAC,KAAKD,MAAN,CADR,EACuB,WADvB,EACoC;AADpC,OAEJE,WAFI,CAEQ,KAAKF,MAFb,CAAP,CADqB,CAGO;AAC7B;;;6BAEQG,U,EAAW;AAAA;;AAClB,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAIC,UAAU,MAAKC,qBAAL,GAA6BC,GAA7B,CAAiCN,UAAjC,CAAd,CADsC,CACsB;;AAE5DI,gBAAQG,SAAR,GAAoB,aAAK;AACvBL;AACD,SAFD;;AAIAE,gBAAQI,OAAR,GAAkB,aAAK;AACrBC,kBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,MAAT,CAAgBC,KAA5B;AACAX,iBAAO,2CAAP;AACD,SAHD;AAID,OAXM,CAAP;AAYD;;;iCAEY;AAAA;;AACX,aAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAIC,UAAU,OAAKC,qBAAL,GAA6BU,KAA7B,EAAd;;AAEEX,gBAAQG,SAAR,GAAoB;AAAA,iBAAKL,QAAQ,oCAAR,CAAL;AAAA,SAApB;;AAEAE,gBAAQI,OAAR,GAAkB,aAAK;AACrBC,kBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASE,KAArB;AACAX,iBAAO,yCAAP;AACD,SAHD;AAIH,OATM,CAAP;AAUD;;;iCAEW;AAAA;;AACV,aAAO,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAIa,SAAS,OAAKX,qBAAL,GAA6BY,UAA7B,EAAb,CADsC,CACiB;;AAEvD,YAAIC,cAAc,EAAlB;AACAF,eAAOT,SAAP,GAAmB,aAAK;AACtB,cAAIY,QAAQR,EAAEC,MAAF,CAASC,MAArB,CADsB,CACO;;AAE7B,cAAGM,KAAH,EAAS;AAAE;AACT,gBAAIC,OAAOD,MAAME,KAAjB,CADO,CACiB;AACxBH,wBAAYI,IAAZ,CAAiB,IAAIC,UAAJ,CAAeH,KAAKI,KAApB,EAA2BJ,KAAKK,WAAhC,EAA6CL,KAAKM,MAAlD,CAAjB;AACAP,kBAAMQ,QAAN,GAHO,CAGW;AACnB,WAJD,MAIO;AACLzB,oBAAQgB,WAAR;AACD;AACF,SAVD;;AAYAF,eAAOR,OAAP,GAAiB,aAAK;AACpBL,iBAAO,wCAAP;AACD,SAFD;AAGD,OAnBM,CAAP;AAoBD","file":"NegociacaoDao.js","sourcesContent":["class NegociacaoDao {\r\n  constructor(connection) {\r\n    this._connection = connection;\r\n    this._store = 'negociacoes';\r\n  }\r\n\r\n  _obtemConnectionStore(){\r\n    return this._connection\r\n      .transaction([this._store], 'readwrite') // connection.transaction(OBJECT STORES, TIPO DE OPERAÇÃO\r\n      .objectStore(this._store) // Pego a Object Store Transacional\r\n  }\r\n\r\n  adiciona(negociacao){\r\n    return new Promise((resolve, reject) => {\r\n      let request = this._obtemConnectionStore().add(negociacao); // Requisição para gravar na store\r\n\r\n      request.onsuccess = e => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = e => {\r\n        console.log(e.target.result.error);\r\n        reject('Não foi possível adicionar uma negociação');\r\n      };\r\n    });\r\n  }\r\n\r\n  apagaTodos() {\r\n    return new Promise((resolve, reject) => {\r\n      let request = this._obtemConnectionStore().clear();\r\n\r\n        request.onsuccess = e => resolve('Negociações removidas com sucesso.');\r\n\r\n        request.onerror = e => {\r\n          console.log(e.target.error);\r\n          reject('Não foi possível apagar as negociações.');\r\n        };\r\n    });\r\n  }\r\n\r\n  listaTodos(){\r\n    return new Promise((resolve, reject) => {\r\n      let cursor = this._obtemConnectionStore().openCursor();// Ele que navega pela Object store\r\n\r\n      let negociacoes = [];\r\n      cursor.onsuccess = e => {\r\n        let atual = e.target.result; // Ponteiro para a negociação atual sendo lida\r\n\r\n        if(atual){ // Se houver dados sendo lidos\r\n          let dado = atual.value; // Pegando o dado real do ponteiro\r\n          negociacoes.push(new Negociacao(dado._data, dado._quantidade, dado._valor));\r\n          atual.continue(); // Manda ir para o proximo\r\n        } else {\r\n          resolve(negociacoes);\r\n        }\r\n      };\r\n\r\n      cursor.onerror = e => {\r\n        reject('Não foi possível listar as negociações');\r\n      };\r\n    });\r\n  }\r\n}\r\n"]}